# =============================================================================
# Window Management Workflow Scenario - Multi-Window Operations
# =============================================================================
#
# Tests window management across multiple applications:
# launch, minimize, maximize, restore, move, resize, list, close
#
# Tools Covered:
#   - app: Launch applications
#   - window_management: find, list, minimize, maximize, restore, move, resize,
#     close, move_and_activate, activate
#
# Prerequisites:
#   - Windows 10/11
#   - Windows MCP Server
#   - Environment: AZURE_OPENAI_ENDPOINT
#
# =============================================================================

criteria:
  success_rate: 1 # 100%

providers:
  - name: azure-openai-gpt41
    type: AZURE
    auth_type: entra_id
    model: gpt-4.1
    baseUrl: "{{AZURE_OPENAI_ENDPOINT}}"
    version: 2025-01-01-preview
    retry:
      retry_on_429: true
      max_retries: 5

  - name: azure-openai-gpt52
    type: AZURE
    auth_type: entra_id
    model: gpt-5.2-chat
    baseUrl: "{{AZURE_OPENAI_ENDPOINT}}"
    version: 2025-01-01-preview
    retry:
      retry_on_429: true
      max_retries: 5

servers:
  - name: windows-mcp
    type: stdio
    command: "{{SERVER_COMMAND}}"
    server_delay: 10s

agents:
  - name: gpt41-agent
    servers:
      - name: windows-mcp
    provider: azure-openai-gpt41
    system_prompt: |
      You are {{AGENT_NAME}}, an autonomous Windows automation agent using {{PROVIDER_NAME}}.
      Session: {{SESSION_NAME}}

      CRITICAL RULES:
      - Execute all tasks IMMEDIATELY without asking for confirmation
      - NEVER ask "Would you like me to...", "Should I proceed...", or similar questions
      - NEVER request clarification - make reasonable assumptions and proceed
      - Use available tools directly to complete the requested tasks
      - Report results after completion, not before starting
    clarification_detection:
      enabled: true
      level: warning
      judge_provider: azure-openai-gpt52

  - name: gpt52-agent
    servers:
      - name: windows-mcp
    provider: azure-openai-gpt52
    system_prompt: |
      You are {{AGENT_NAME}}, an autonomous Windows automation agent using {{PROVIDER_NAME}}.
      Session: {{SESSION_NAME}}

      CRITICAL RULES:
      - Execute all tasks IMMEDIATELY without asking for confirmation
      - NEVER ask "Would you like me to...", "Should I proceed...", or similar questions
      - NEVER request clarification - make reasonable assumptions and proceed
      - Use available tools directly to complete the requested tasks
      - Report results after completion, not before starting
    clarification_detection:
      enabled: true
      level: warning
      judge_provider: azure-openai-gpt52

ai_summary:
  enabled: true
  judge_provider: azure-openai-gpt52

settings:
  verbose: true
  max_iterations: 25
  session_delay: 5s
  test_delay: 2s
  tool_timeout: 60s

sessions:
  - name: Multi-Window Management Workflow
    agents:
      - gpt41-agent
      - gpt52-agent
    tests:
      - name: "Launch and manage multiple application windows"
        description: "Launch Notepad and Calculator, manipulate windows, close cleanly"
        prompt: |
          Perform this complete window management workflow:

          1. Launch Notepad (notepad.exe)
          2. Launch Calculator (calc.exe)
          3. List all windows to see both applications
          4. Minimize Notepad
          5. Maximize Calculator
          6. Restore Notepad
          7. Move Calculator to position (100, 100)
          8. Resize Notepad to 800x600
          9. Close both applications (click "Don't Save" for Notepad if prompted)
          10. Verify both applications are closed

          Report which operations succeeded and confirm both apps are closed.
        assertions:
          # REQUIRED: Must launch both apps (using 'app' tool)
          - type: tool_param_matches_regex
            tool: app
            params:
              programPath: "(?i)notepad"

          - type: tool_param_matches_regex
            tool: app
            params:
              programPath: "(?i)calc"

          # REQUIRED: Must use window manipulation operations
          - anyOf:
              - type: tool_param_matches_regex
                tool: window_management
                params:
                  action: "(?i)(minimize|maximize|restore|move|resize)"
              - type: output_regex
                pattern: "(?i)(minimized|maximized|restored|moved|resized)"

          # OUTCOME: Both apps were closed
          - type: output_regex
            pattern: "(?i)(both.*closed|closed.*both|notepad.*closed|calculator.*closed)"

          # SAFETY: No failure indicators
          - type: output_not_contains
            value: "failed"

          # QUALITY: Only used real tools
          - type: no_hallucinated_tools

          # QUALITY: No errors during execution
          - type: no_error_messages

          # QUALITY: Agent executed directly without asking for confirmation
          - type: no_clarification_questions

          # QUALITY: No rate limit errors encountered
          - type: no_rate_limit_errors

  - name: Window Activate Workflow
    agents:
      - gpt41-agent
      - gpt52-agent
    tests:
      - name: "Activate and bring windows to foreground"
        description: "Launch apps, switch focus between them, verify activation"
        prompt: |
          Test window activation:

          1. Launch Notepad (notepad.exe)
          2. Launch Calculator (calc.exe)
          3. Get the foreground window (should be Calculator)
          4. Activate Notepad window to bring it to front
          5. Verify Notepad is now the foreground window
          6. Use move_and_activate to move Calculator to (200, 200) and activate it
          7. Close both applications

          Report which window is foreground after each activation, and confirm cleanup.
        assertions:
          # REQUIRED: Must use activate or move_and_activate
          - anyOf:
              - type: tool_param_matches_regex
                tool: window_management
                params:
                  action: "(?i)(activate|move_and_activate|get_foreground)"
              - type: output_regex
                pattern: "(?i)(activated|foreground|front)"

          # OUTCOME: Apps were closed
          - type: output_regex
            pattern: "(?i)(closed|cleaned)"

          # SAFETY: No failure indicators
          - type: output_not_contains
            value: "failed"

          # QUALITY: Only used real tools
          - type: no_hallucinated_tools

          # QUALITY: No errors during execution
          - type: no_error_messages

          # QUALITY: Agent executed directly without asking for confirmation
          - type: no_clarification_questions

          # QUALITY: No rate limit errors encountered
          - type: no_rate_limit_errors
