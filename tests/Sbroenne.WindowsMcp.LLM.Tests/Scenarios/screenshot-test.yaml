# =============================================================================
# Screenshot Test - Screenshot Control Tools
# =============================================================================
#
# User Story 4: Screenshot and File Tools (Priority: P2) - Part 1
#
# Tests: screenshot_control tool actions
#
# Tools Covered:
#   - screenshot_control(capture, annotate=true): Capture with element labels
#   - screenshot_control(capture, annotate=false): Plain screenshot
#   - screenshot_control(list_monitors): List available displays
#   - screenshot_control with windowHandle: Capture specific window
#
# Test Applications:
#   - Notepad: For annotated screenshots
#   - Paint: For plain screenshots
#
# Prerequisites:
#   - Windows 10/11
#   - Windows MCP Server
#   - Environment: AZURE_OPENAI_ENDPOINT
#
# =============================================================================

criteria:
  success_rate: 1  # 100% required

providers:
  - name: azure-openai-gpt41
    type: AZURE
    auth_type: entra_id
    model: gpt-4.1
    baseUrl: "{{AZURE_OPENAI_ENDPOINT}}"
    version: 2025-01-01-preview
  - name: azure-openai-gpt5-chat
    type: AZURE
    auth_type: entra_id
    model: gpt-5.2-chat
    baseUrl: "{{AZURE_OPENAI_ENDPOINT}}"
    version: 2025-01-01-preview
servers:
  - name: windows-mcp
    type: stdio
    command: "{{SERVER_COMMAND}}"
    server_delay: 10s

agents:
  - name: gpt41-agent
    servers:
      - name: windows-mcp
    provider: azure-openai-gpt41
    system_prompt: |
      You are {{AGENT_NAME}}, an autonomous Windows automation agent using {{PROVIDER_NAME}}.
      Session: {{SESSION_NAME}}
      
      CRITICAL RULES:
      - Execute all tasks IMMEDIATELY without asking for confirmation
      - NEVER ask "Would you like me to...", "Should I proceed...", or similar questions
      - NEVER request clarification - make reasonable assumptions and proceed
      - Use available tools directly to complete the requested tasks
      - Report results after completion, not before starting
    clarification_detection:
      enabled: true
      level: warning
      use_builtin_patterns: true

  - name: gpt5-chat-agent
    servers:
      - name: windows-mcp
    provider: azure-openai-gpt5-chat
    system_prompt: |
      You are {{AGENT_NAME}}, an autonomous Windows automation agent using {{PROVIDER_NAME}}.
      Session: {{SESSION_NAME}}
      
      CRITICAL RULES:
      - Execute all tasks IMMEDIATELY without asking for confirmation
      - NEVER ask "Would you like me to...", "Should I proceed...", or similar questions
      - NEVER request clarification - make reasonable assumptions and proceed
      - Use available tools directly to complete the requested tasks
      - Report results after completion, not before starting
    clarification_detection:
      enabled: true
      level: warning
      use_builtin_patterns: true

settings:
  verbose: true
  max_iterations: 15


sessions:
  # ==========================================================================
  # Session 1: Annotated Screenshot - capture with element labels
  # ==========================================================================
  - name: "Annotated Screenshot"
    tests:
      - name: "Cleanup - Close existing Notepad windows"
        prompt: |
          Close all Notepad windows if any are open.
        assertions:
          - type: no_hallucinated_tools

      - name: "Launch Notepad"
        prompt: |
          Open Notepad.
        assertions:
          - type: no_hallucinated_tools
          - type: tool_called
            tool: app

      - name: "Take an annotated screenshot of Notepad"
        prompt: |
          Take a screenshot of the Notepad window with element labels showing all UI elements.
        assertions:
          - type: no_hallucinated_tools
          - type: tool_called
            tool: screenshot_control
          - type: tool_param_equals
            tool: screenshot_control
            params:
              annotate: true
          - type: output_regex
            pattern: "(?i)(element|label|annotation|ui|menu|edit|file)"

      - name: "Close Notepad"
        prompt: |
          Close Notepad without saving.
        assertions:
          - type: no_hallucinated_tools

  # ==========================================================================
  # Session 2: Plain Screenshot - capture without annotations
  # ==========================================================================
  - name: "Plain Screenshot"
    tests:
      - name: "Cleanup - Close existing Paint windows"
        prompt: |
          Close all Paint windows if any are open.
        assertions:
          - type: no_hallucinated_tools

      - name: "Launch Paint"
        prompt: |
          Open Microsoft Paint.
        assertions:
          - type: no_hallucinated_tools
          - type: tool_called
            tool: app

      - name: "Take a plain screenshot of Paint"
        prompt: |
          Take a screenshot of the Paint window without any annotations or labels.
        assertions:
          - type: no_hallucinated_tools
          - type: tool_called
            tool: screenshot_control
          - type: tool_param_equals
            tool: screenshot_control
            params:
              annotate: false

      - name: "Close Paint"
        prompt: |
          Close Paint without saving.
        assertions:
          - type: no_hallucinated_tools

  # ==========================================================================
  # Session 3: Monitor List - enumerate available displays
  # ==========================================================================
  - name: "Monitor List"
    tests:
      - name: "List all monitors"
        prompt: |
          List all available monitors and displays on this computer.
        assertions:
          - type: no_hallucinated_tools
          - type: tool_called
            tool: screenshot_control
          - type: tool_param_equals
            tool: screenshot_control
            params:
              action: "list_monitors"
          - type: output_regex
            pattern: "(?i)(monitor|display|screen|primary|\\d+x\\d+)"

  # ==========================================================================
  # Session 4: Window Screenshot - capture specific window by handle
  # ==========================================================================
  - name: "Window Screenshot"
    tests:
      - name: "Cleanup - Close existing Notepad windows"
        prompt: |
          Close all Notepad windows if any are open.
        assertions:
          - type: no_hallucinated_tools

      - name: "Launch Notepad"
        prompt: |
          Open Notepad.
        assertions:
          - type: no_hallucinated_tools
          - type: tool_called
            tool: app

      - name: "Find the Notepad window"
        prompt: |
          Find the Notepad window and get its handle.
        assertions:
          - type: no_hallucinated_tools
          - type: tool_called
            tool: window_management
          - type: output_regex
            pattern: "(?i)(handle|notepad|found|window)"

      - name: "Take a screenshot of just the Notepad window"
        prompt: |
          Take a screenshot of only the Notepad window, not the entire screen.
        assertions:
          - type: no_hallucinated_tools
          - type: tool_called
            tool: screenshot_control

      - name: "Close Notepad"
        prompt: |
          Close Notepad without saving.
        assertions:
          - type: no_hallucinated_tools

