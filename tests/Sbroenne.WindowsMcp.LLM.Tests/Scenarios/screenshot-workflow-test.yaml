# =============================================================================
# Screenshot Workflow Scenario - Screenshot Capture Operations
# =============================================================================
#
# Tests screenshot capture across different targets and scenarios
#
# Tools Covered:
#   - screenshot_control: Capture screenshots (primary, secondary, window, region)
#   - window_management: Launch and manage windows for screenshot targets
#
# Prerequisites:
#   - Windows 10/11
#   - Windows MCP Server
#   - Environment: AZURE_OPENAI_ENDPOINT
#
# =============================================================================

criteria:
  success_rate: 1 # 100%

providers:
  - name: azure-openai-gpt41
    type: AZURE
    auth_type: entra_id
    model: gpt-4.1
    baseUrl: "{{AZURE_OPENAI_ENDPOINT}}"
    version: 2025-01-01-preview
    retry:
      retry_on_429: true
      max_retries: 5

  - name: azure-openai-gpt52
    type: AZURE
    auth_type: entra_id
    model: gpt-5.2-chat
    baseUrl: "{{AZURE_OPENAI_ENDPOINT}}"
    version: 2025-01-01-preview
    retry:
      retry_on_429: true
      max_retries: 5

servers:
  - name: windows-mcp
    type: stdio
    command: "{{SERVER_COMMAND}}"
    server_delay: 10s

agents:
  - name: gpt41-agent
    servers:
      - name: windows-mcp
    provider: azure-openai-gpt41
    system_prompt: |
      You are {{AGENT_NAME}}, an autonomous Windows automation agent using {{PROVIDER_NAME}}.
      Session: {{SESSION_NAME}}

      CRITICAL RULES:
      - Execute all tasks IMMEDIATELY without asking for confirmation
      - NEVER ask "Would you like me to...", "Should I proceed...", or similar questions
      - NEVER request clarification - make reasonable assumptions and proceed
      - Use available tools directly to complete the requested tasks
      - Report results after completion, not before starting
    clarification_detection:
      enabled: true
      level: warning
      judge_provider: azure-openai-gpt52

  - name: gpt52-agent
    servers:
      - name: windows-mcp
    provider: azure-openai-gpt52
    system_prompt: |
      You are {{AGENT_NAME}}, an autonomous Windows automation agent using {{PROVIDER_NAME}}.
      Session: {{SESSION_NAME}}

      CRITICAL RULES:
      - Execute all tasks IMMEDIATELY without asking for confirmation
      - NEVER ask "Would you like me to...", "Should I proceed...", or similar questions
      - NEVER request clarification - make reasonable assumptions and proceed
      - Use available tools directly to complete the requested tasks
      - Report results after completion, not before starting
    clarification_detection:
      enabled: true
      level: warning
      judge_provider: azure-openai-gpt52

ai_summary:
  enabled: true
  judge_provider: azure-openai-gpt52

settings:
  verbose: true
  max_iterations: 20
  session_delay: 5s
  test_delay: 2s
  tool_timeout: 60s

sessions:
  - name: Desktop Screenshot Workflow
    agents:
      - gpt41-agent
      - gpt52-agent
    tests:
      - name: "Capture desktop and describe content"
        description: "Take screenshot of primary screen and describe visible elements"
        prompt: |
          Capture and analyze the desktop:

          1. Take a screenshot of the primary screen
          2. Describe what you see in the screenshot (desktop icons, taskbar, any open windows)
          3. List available monitors using screenshot_control list_monitors action
          4. Report the monitor configuration

          Report "Desktop captured" and describe at least 3 visible elements.
        assertions:
          # REQUIRED: Must capture screenshot
          - type: tool_called
            tool: screenshot_control

          # OUTCOME: Screenshot was captured (agent describes content)
          - type: output_regex
            pattern: "(?i)(desktop|taskbar|screen|icon|window|captured|monitor)"

          # OUTCOME: Multiple elements described
          - type: output_regex
            pattern: "(?i)(1\\.|2\\.|3\\.|first|second|third|taskbar|icon|start)"

          # QUALITY: Only used real tools
          - type: no_hallucinated_tools

          # QUALITY: No errors during execution
          - type: no_error_messages

          # QUALITY: Agent executed directly without asking for confirmation
          - type: no_clarification_questions

          # QUALITY: No rate limit errors encountered
          - type: no_rate_limit_errors

  - name: Window Screenshot Workflow
    agents:
      - gpt41-agent
      - gpt52-agent
    tests:
      - name: "Capture specific window screenshot"
        description: "Launch Notepad, capture its window specifically, close"
        prompt: |
          Capture a specific window's screenshot:

          1. Launch Notepad (notepad.exe)
          2. Type some text: "Screenshot test content"
          3. Get the window handle for Notepad
          4. Take a screenshot specifically of the Notepad window (using window target)
          5. Describe what you see in the Notepad screenshot
          6. Close Notepad (click "Don't Save" if prompted)

          Report "Window captured" and describe the Notepad content you see.
        assertions:
          # REQUIRED: Must launch then screenshot (using 'app' tool)
          - type: tool_call_order
            sequence:
              - app
              - screenshot_control

          # REQUIRED: Screenshot must target a window
          - type: tool_param_matches_regex
            tool: screenshot_control
            params:
              target: "(?i)window"

          # OUTCOME: Notepad content was described
          - type: output_regex
            pattern: "(?i)(notepad|text|content|screenshot.*test|captured)"

          # OUTCOME: Notepad was closed
          - type: output_regex
            pattern: "(?i)(closed|notepad.*(closed|exited))"

          # QUALITY: Only used real tools
          - type: no_hallucinated_tools

          # QUALITY: No errors during execution
          - type: no_error_messages

          # QUALITY: Agent executed directly without asking for confirmation
          - type: no_clarification_questions

          # QUALITY: No rate limit errors encountered
          - type: no_rate_limit_errors
