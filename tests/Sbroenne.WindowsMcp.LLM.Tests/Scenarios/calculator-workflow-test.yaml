# =============================================================================
# Calculator Workflow Scenario - Keyboard and UI Automation
# =============================================================================
#
# Tests Calculator automation with keyboard input and UI element interaction
#
# Tools Covered:
#   - app: Launch Calculator
#   - keyboard_control: Type numbers and operators
#   - ui_find: Find Calculator buttons
#   - ui_click: Click Calculator buttons
#   - ui_read: Read Calculator display
#
# Prerequisites:
#   - Windows 10/11 with Calculator app
#   - Windows MCP Server
#   - Environment: AZURE_OPENAI_ENDPOINT
#
# =============================================================================

criteria:
  success_rate: 1 # 100%

providers:
  - name: azure-openai-gpt41
    type: AZURE
    auth_type: entra_id
    model: gpt-4.1
    baseUrl: "{{AZURE_OPENAI_ENDPOINT}}"
    version: 2025-01-01-preview
    retry:
      retry_on_429: true
      max_retries: 5

  - name: azure-openai-gpt52
    type: AZURE
    auth_type: entra_id
    model: gpt-5.2-chat
    baseUrl: "{{AZURE_OPENAI_ENDPOINT}}"
    version: 2025-01-01-preview
    retry:
      retry_on_429: true
      max_retries: 5

servers:
  - name: windows-mcp
    type: stdio
    command: "{{SERVER_COMMAND}}"
    server_delay: 10s

agents:
  - name: gpt41-agent
    servers:
      - name: windows-mcp
    provider: azure-openai-gpt41
    system_prompt: |
      You are {{AGENT_NAME}}, an autonomous Windows automation agent using {{PROVIDER_NAME}}.
      Session: {{SESSION_NAME}}

      CRITICAL RULES:
      - Execute all tasks IMMEDIATELY without asking for confirmation
      - NEVER ask "Would you like me to...", "Should I proceed...", or similar questions
      - NEVER request clarification - make reasonable assumptions and proceed
      - Use available tools directly to complete the requested tasks
      - Report results after completion, not before starting
    clarification_detection:
      enabled: true
      level: warning
      judge_provider: azure-openai-gpt52

  - name: gpt52-agent
    servers:
      - name: windows-mcp
    provider: azure-openai-gpt52
    system_prompt: |
      You are {{AGENT_NAME}}, an autonomous Windows automation agent using {{PROVIDER_NAME}}.
      Session: {{SESSION_NAME}}

      CRITICAL RULES:
      - Execute all tasks IMMEDIATELY without asking for confirmation
      - NEVER ask "Would you like me to...", "Should I proceed...", or similar questions
      - NEVER request clarification - make reasonable assumptions and proceed
      - Use available tools directly to complete the requested tasks
      - Report results after completion, not before starting
    clarification_detection:
      enabled: true
      level: warning
      judge_provider: azure-openai-gpt52

ai_summary:
  enabled: true
  judge_provider: azure-openai-gpt52

settings:
  verbose: true
  max_iterations: 20
  session_delay: 5s
  test_delay: 2s
  tool_timeout: 60s

sessions:
  - name: Calculator Keyboard Workflow
    agents:
      - gpt41-agent
      - gpt52-agent
    tests:
      - name: "Perform calculation using keyboard input"
        description: "Launch Calculator, type calculation using keyboard, read result"
        prompt: |
          Perform a calculation using keyboard input:

          1. Launch Calculator (calc.exe)
          2. Get the window handle
          3. Use keyboard input to type: 25 + 17 =
          4. Read the result from the Calculator display using UI automation
          5. Report the result (should be 42)
          6. Close Calculator

          Report "Calculation result: [value]" and confirm Calculator was closed.
        assertions:
          # REQUIRED: Must launch Calculator first (using 'app' tool)
          - type: tool_call_order
            sequence:
              - app
              - keyboard_control

          # OUTCOME: Keyboard was used for input
          - type: tool_param_matches_regex
            tool: keyboard_control
            params:
              action: "(?i)(type|press|sequence)"

          # OUTCOME: Result was reported (42 or at least a number)
          - type: output_regex
            pattern: "(?i)(result|answer|equals|display).*(\\d+|42)"

          # OUTCOME: Calculator was closed
          - type: output_regex
            pattern: "(?i)(closed|calculator.*(closed|exited)|verified)"

          # SAFETY: No failure indicators
          - type: output_not_contains
            value: "failed"

          # QUALITY: Only used real tools
          - type: no_hallucinated_tools

          # QUALITY: No errors during execution
          - type: no_error_messages

          # QUALITY: Agent executed directly without asking for confirmation
          - type: no_clarification_questions

          # QUALITY: No rate limit errors encountered
          - type: no_rate_limit_errors

  - name: Calculator UI Click Workflow
    agents:
      - gpt41-agent
      - gpt52-agent
    tests:
      - name: "Perform calculation using UI button clicks"
        description: "Launch Calculator, click buttons to perform calculation"
        prompt: |
          Perform a calculation using UI button clicks (not keyboard):

          1. Launch Calculator (calc.exe)
          2. Get the window handle
          3. Use UI automation to find and click the following buttons in order:
             - Click "5" button
             - Click "Ã—" (multiply) button
             - Click "8" button
             - Click "=" button
          4. Read the result from the display (should be 40)
          5. Close Calculator

          Report "Calculation result: [value]" and confirm Calculator was closed.
        assertions:
          # REQUIRED: Must launch Calculator first (using 'app' tool)
          - type: tool_call_order
            sequence:
              - app
              - ui_click

          # OUTCOME: UI clicks were used
          - type: tool_param_matches_regex
            tool: ui_click
            params:
              controlType: "(?i)button"

          # OUTCOME: Result was reported
          - type: output_regex
            pattern: "(?i)(result|answer|equals|display).*(\\d+|40)"

          # OUTCOME: Calculator was closed
          - type: output_regex
            pattern: "(?i)(closed|calculator.*(closed|exited)|verified)"

          # SAFETY: No failure indicators
          - type: output_not_contains
            value: "failed"

          # QUALITY: Only used real tools
          - type: no_hallucinated_tools

          # QUALITY: No errors during execution
          - type: no_error_messages

          # QUALITY: Agent executed directly without asking for confirmation
          - type: no_clarification_questions

          # QUALITY: No rate limit errors encountered
          - type: no_rate_limit_errors
