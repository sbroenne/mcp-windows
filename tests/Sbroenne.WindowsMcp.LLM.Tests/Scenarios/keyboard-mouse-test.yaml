# =============================================================================
# Keyboard and Mouse Control Test
# =============================================================================
#
# User Story 3: Keyboard and Mouse Control (Priority: P2)
#
# Tests: keyboard_control and mouse_control tools
#
# Tools Covered:
#   - keyboard_control(type): Type text
#   - keyboard_control(press): Press key combinations (hotkeys)
#   - mouse_control(click): Click at coordinates
#   - mouse_control(drag): Drag from one point to another
#   - mouse_control(get_position): Get current mouse position
#
# Test Applications:
#   - Notepad: For keyboard tests
#   - Paint: For mouse tests (canvas drawing)
#
# Prerequisites:
#   - Windows 10/11
#   - Windows MCP Server
#   - Environment: AZURE_OPENAI_ENDPOINT
#
# =============================================================================

criteria:
  success_rate: 1  # 100% required

providers:
  - name: azure-openai-gpt41
    type: AZURE
    auth_type: entra_id
    model: gpt-4.1
    baseUrl: "{{AZURE_OPENAI_ENDPOINT}}"
    version: 2025-01-01-preview
    rate_limits:
      tpm: 150000
      rpm: 150

  - name: azure-openai-gpt5-chat
    type: AZURE
    auth_type: entra_id
    model: gpt-5.2-chat
    baseUrl: "{{AZURE_OPENAI_ENDPOINT}}"
    version: 2025-01-01-preview
    rate_limits:
      tpm: 150000
      rpm: 1500

servers:
  - name: windows-mcp
    type: stdio
    command: "{{SERVER_COMMAND}}"
    server_delay: 10s

agents:
  - name: gpt41-agent
    servers:
      - name: windows-mcp
    provider: azure-openai-gpt41
    system_prompt: |
      You are {{AGENT_NAME}}, an autonomous Windows automation agent using {{PROVIDER_NAME}}.
      Session: {{SESSION_NAME}}
      
      CRITICAL RULES:
      - Execute all tasks IMMEDIATELY without asking for confirmation
      - NEVER ask "Would you like me to...", "Should I proceed...", or similar questions
      - NEVER request clarification - make reasonable assumptions and proceed
      - Use available tools directly to complete the requested tasks
      - Report results after completion, not before starting
    clarification_detection:
      enabled: true
      level: warning
      use_builtin_patterns: true

  - name: gpt5-chat-agent
    servers:
      - name: windows-mcp
    provider: azure-openai-gpt5-chat
    system_prompt: |
      You are {{AGENT_NAME}}, an autonomous Windows automation agent using {{PROVIDER_NAME}}.
      Session: {{SESSION_NAME}}
      
      CRITICAL RULES:
      - Execute all tasks IMMEDIATELY without asking for confirmation
      - NEVER ask "Would you like me to...", "Should I proceed...", or similar questions
      - NEVER request clarification - make reasonable assumptions and proceed
      - Use available tools directly to complete the requested tasks
      - Report results after completion, not before starting
    clarification_detection:
      enabled: true
      level: warning
      use_builtin_patterns: true

settings:
  verbose: true
  max_iterations: 15
  test_delay: 60s

sessions:
  # ==========================================================================
  # Session 1: Typing - keyboard_control(type) with text in Notepad
  # ==========================================================================
  - name: "Typing"
    tests:
      - name: "Cleanup - Close existing Notepad windows"
        prompt: |
          Close all Notepad windows if any are open.
        assertions:
          - type: no_hallucinated_tools
          - type: max_latency_ms
            value: 15000

      - name: "Launch Notepad"
        prompt: |
          Open Notepad.
        assertions:
          - type: no_hallucinated_tools
          - type: tool_called
            tool: app
          - type: max_latency_ms
            value: 15000

      - name: "Type a sentence using keyboard"
        prompt: |
          Type "Hello World from keyboard control!" using the keyboard.
        assertions:
          - type: no_hallucinated_tools
          - anyOf:
              - type: tool_called
                tool: keyboard_control
              - type: tool_called
                tool: ui_type
          - type: max_latency_ms
            value: 30000

      - name: "Type on a new line"
        prompt: |
          Press Enter and type "This is a second line of text" on the new line.
        assertions:
          - type: no_hallucinated_tools
          - anyOf:
              - type: tool_called
                tool: keyboard_control
              - type: tool_called
                tool: ui_type
          - type: max_latency_ms
            value: 30000

      - name: "Close Notepad"
        prompt: |
          Close Notepad without saving.
        assertions:
          - type: no_hallucinated_tools
          - type: max_latency_ms
            value: 20000

  # ==========================================================================
  # Session 2: Hotkeys - keyboard_control(press) with Ctrl+A, Ctrl+C, Ctrl+V
  # ==========================================================================
  - name: "Hotkeys"
    tests:
      - name: "Cleanup - Close existing Notepad windows"
        prompt: |
          Close all Notepad windows if any are open.
        assertions:
          - type: no_hallucinated_tools
          - type: max_latency_ms
            value: 15000

      - name: "Launch Notepad"
        prompt: |
          Open Notepad.
        assertions:
          - type: no_hallucinated_tools
          - type: tool_called
            tool: app
          - type: max_latency_ms
            value: 15000

      - name: "Type some text"
        prompt: |
          Type "Text to select and copy" in Notepad.
        assertions:
          - type: no_hallucinated_tools
          - anyOf:
              - type: tool_called
                tool: keyboard_control
              - type: tool_called
                tool: ui_type
          - type: max_latency_ms
            value: 30000

      - name: "Select all text with Ctrl+A"
        prompt: |
          Select all the text in Notepad using the keyboard shortcut.
        assertions:
          - type: no_hallucinated_tools
          - type: tool_called
            tool: keyboard_control
          - type: tool_param_matches_regex
            tool: keyboard_control
            params:
              key: "(?i)a"
          - type: max_latency_ms
            value: 30000

      - name: "Copy with Ctrl+C"
        prompt: |
          Copy the selected text to the clipboard using the keyboard shortcut.
        assertions:
          - type: no_hallucinated_tools
          - type: tool_called
            tool: keyboard_control
          - type: tool_param_matches_regex
            tool: keyboard_control
            params:
              key: "(?i)c"
          - type: max_latency_ms
            value: 30000

      - name: "Go to end and add new line"
        prompt: |
          Press End to go to the end of the document, then press Enter for a new line.
        assertions:
          - type: no_hallucinated_tools
          - type: tool_called
            tool: keyboard_control
          - type: max_latency_ms
            value: 30000

      - name: "Paste with Ctrl+V"
        prompt: |
          Paste the text from clipboard using the keyboard shortcut.
        assertions:
          - type: no_hallucinated_tools
          - type: tool_called
            tool: keyboard_control
          - type: tool_param_matches_regex
            tool: keyboard_control
            params:
              key: "(?i)v"
          - type: max_latency_ms
            value: 30000

      - name: "Close Notepad"
        prompt: |
          Close Notepad without saving.
        assertions:
          - type: no_hallucinated_tools
          - type: max_latency_ms
            value: 20000

  # ==========================================================================
  # Session 3: Mouse Click - mouse_control(click) at coordinates in Paint
  # ==========================================================================
  - name: "Mouse Click"
    tests:
      - name: "Cleanup - Close existing Paint windows"
        prompt: |
          Close all Paint windows if any are open.
        assertions:
          - type: no_hallucinated_tools
          - type: max_latency_ms
            value: 15000

      - name: "Launch Paint"
        prompt: |
          Open Microsoft Paint.
        assertions:
          - type: no_hallucinated_tools
          - type: tool_called
            tool: app
          - type: tool_param_equals
            tool: app
            params:
              programPath: "mspaint.exe"
          - type: max_latency_ms
            value: 15000

      - name: "Click in the canvas area"
        prompt: |
          Click somewhere in the middle of the Paint canvas area to make a mark.
        assertions:
          - type: no_hallucinated_tools
          - anyOf:
              - type: tool_called
                tool: mouse_control
              - type: tool_called
                tool: ui_click
          - type: max_latency_ms
            value: 30000

      - name: "Click in another location"
        prompt: |
          Click at a different location in the canvas to make another mark.
        assertions:
          - type: no_hallucinated_tools
          - anyOf:
              - type: tool_called
                tool: mouse_control
              - type: tool_called
                tool: ui_click
          - type: max_latency_ms
            value: 30000

      - name: "Close Paint"
        prompt: |
          Close Paint without saving.
        assertions:
          - type: no_hallucinated_tools
          - type: max_latency_ms
            value: 20000

  # ==========================================================================
  # Session 4: Mouse Drag - mouse_control(drag) for drawing a line in Paint
  # ==========================================================================
  - name: "Mouse Drag"
    tests:
      - name: "Cleanup - Close existing Paint windows"
        prompt: |
          Close all Paint windows if any are open.
        assertions:
          - type: no_hallucinated_tools
          - type: max_latency_ms
            value: 15000

      - name: "Launch Paint"
        prompt: |
          Open Microsoft Paint.
        assertions:
          - type: no_hallucinated_tools
          - type: tool_called
            tool: app
          - type: max_latency_ms
            value: 15000

      - name: "Draw a line by dragging"
        prompt: |
          Draw a diagonal line across the Paint canvas by dragging from one corner to another.
        assertions:
          - type: no_hallucinated_tools
          - type: tool_called
            tool: mouse_control
          - type: tool_param_equals
            tool: mouse_control
            params:
              action: "drag"
          - type: max_latency_ms
            value: 30000

      - name: "Draw another line"
        prompt: |
          Draw a horizontal line across the middle of the canvas.
        assertions:
          - type: no_hallucinated_tools
          - type: tool_called
            tool: mouse_control
          - type: tool_param_equals
            tool: mouse_control
            params:
              action: "drag"
          - type: max_latency_ms
            value: 30000

      - name: "Close Paint"
        prompt: |
          Close Paint without saving.
        assertions:
          - type: no_hallucinated_tools
          - type: max_latency_ms
            value: 20000

  # ==========================================================================
  # Session 5: Mouse Position - mouse_control(get_position)
  # ==========================================================================
  - name: "Mouse Position"
    tests:
      - name: "Get current mouse position"
        prompt: |
          Get the current position of the mouse cursor on the screen.
        assertions:
          - type: no_hallucinated_tools
          - type: tool_called
            tool: mouse_control
          - type: tool_param_equals
            tool: mouse_control
            params:
              action: "get_position"
          - type: output_regex
            pattern: "(?i)(x|y|position|coordinate|\\d+)"
          - type: max_latency_ms
            value: 15000

      - name: "Move mouse and get position again"
        prompt: |
          Move the mouse to position 500, 400 and then report the current mouse position.
        assertions:
          - type: no_hallucinated_tools
          - type: tool_called
            tool: mouse_control
          - type: max_latency_ms
            value: 30000
