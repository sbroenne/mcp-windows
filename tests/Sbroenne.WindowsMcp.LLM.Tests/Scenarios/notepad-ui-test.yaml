# =============================================================================
# Notepad Workflow Scenario - End-to-End Notepad Automation
# =============================================================================
#
# Tests complete Notepad workflows: launch, type, save, close
#
# Tools Covered:
#   - app: Launch Notepad
#   - keyboard_control / ui_type: Type text
#   - window_management: Verify and close windows
#   - file_save: Save files (implicit in "save" workflow)
#
# Prerequisites:
#   - Windows 10/11
#   - Windows MCP Server
#   - Environment: AZURE_OPENAI_ENDPOINT
#
# =============================================================================

criteria:
  success_rate: 1 # 100%

providers:
  - name: azure-openai-gpt41
    type: AZURE
    auth_type: entra_id
    model: gpt-4.1
    baseUrl: "{{AZURE_OPENAI_ENDPOINT}}"
    version: 2025-01-01-preview
    retry:
      retry_on_429: true
      max_retries: 5

  - name: azure-openai-gpt52
    type: AZURE
    auth_type: entra_id
    model: gpt-5.2-chat
    baseUrl: "{{AZURE_OPENAI_ENDPOINT}}"
    version: 2025-01-01-preview
    retry:
      retry_on_429: true
      max_retries: 5

servers:
  - name: windows-mcp
    type: stdio
    command: "{{SERVER_COMMAND}}"
    server_delay: 10s

agents:
  - name: gpt41-agent
    servers:
      - name: windows-mcp
    provider: azure-openai-gpt41
    system_prompt: |
      You are {{AGENT_NAME}}, an autonomous Windows automation agent using {{PROVIDER_NAME}}.
      Session: {{SESSION_NAME}}

      CRITICAL RULES:
      - Execute all tasks IMMEDIATELY without asking for confirmation
      - NEVER ask "Would you like me to...", "Should I proceed...", or similar questions
      - NEVER request clarification - make reasonable assumptions and proceed
      - Use available tools directly to complete the requested tasks
      - Report results after completion, not before starting
    clarification_detection:
      enabled: true
      level: warning
      judge_provider: azure-openai-gpt52

  - name: gpt52-agent
    servers:
      - name: windows-mcp
    provider: azure-openai-gpt52
    system_prompt: |
      You are {{AGENT_NAME}}, an autonomous Windows automation agent using {{PROVIDER_NAME}}.
      Session: {{SESSION_NAME}}

      CRITICAL RULES:
      - Execute all tasks IMMEDIATELY without asking for confirmation
      - NEVER ask "Would you like me to...", "Should I proceed...", or similar questions
      - NEVER request clarification - make reasonable assumptions and proceed
      - Use available tools directly to complete the requested tasks
      - Report results after completion, not before starting
    clarification_detection:
      enabled: true
      level: warning
      judge_provider: azure-openai-gpt52

ai_summary:
  enabled: true
  judge_provider: azure-openai-gpt52

settings:
  verbose: true
  max_iterations: 15
  session_delay: 5s
  test_delay: 2s
  tool_timeout: 60s
sessions:
  - name: Notepad Workflow - Discard
    agents:
      - gpt41-agent
      - gpt52-agent
    tests:
      - name: "Complete Notepad automation (discard)"
        description: "Open Notepad, type text, close without saving"
        prompt: |
          1. Launch Notepad
          2. Type "Hello World"
          3. Record proof that this worked (no screenshots, just text)
          4. Close Notepad and click "Don't Save" if prompted
          5. Verify no Notepad window is open (search for it)

          Report "VERIFIED: No Notepad window open" if closed successfully.
        assertions:
          # REQUIRED: Must launch Notepad first, then type text
          - anyOf:
              - type: tool_call_order
                sequence:
                  - app
                  - keyboard_control
              - type: tool_call_order
                sequence:
                  - app
                  - ui_type

          # OUTCOME: Proof that "Hello World" was typed
          - anyOf:
              - type: output_regex
                pattern: "(?i)hello\\s*world"
              - type: tool_param_matches_regex
                tool: keyboard_control
                params:
                  text: "(?i)hello.*world"
              - type: tool_param_matches_regex
                tool: ui_type
                params:
                  text: "(?i)hello.*world"

          # OUTCOME: LLM verified Notepad was closed
          - type: output_regex
            pattern: "(?i)(no.*(notepad|window).*(open|found|running)|verified|notepad.*(closed|not found|no longer))"

          # QUALITY: Only used real tools
          - type: no_hallucinated_tools

          # QUALITY: No errors during execution
          - type: no_error_messages

          # QUALITY: Agent executed directly without asking for confirmation
          - type: no_clarification_questions

          # QUALITY: No rate limit errors encountered
          - type: no_rate_limit_errors

  - name: Notepad Workflow - Save
    agents:
      - gpt41-agent
      - gpt52-agent
    tests:
      - name: "Complete Notepad automation (save file)"
        description: "Open Notepad, type text, save to temp directory, close"
        prompt: |
          1. Launch Notepad
          2. Type "Hello World from Agent Benchmark"
          3. Save the file to {{TEMP_DIR}}/agent-benchmark-{{RUN_ID}}.txt
          4. Record proof that this worked (confirm the file was saved)
          5. Close Notepad
          6. Verify no Notepad window is open (search for it)

          Report "VERIFIED: File saved and Notepad closed" if successful.
        assertions:
          # REQUIRED: Must launch Notepad first, then type text
          - anyOf:
              - type: tool_call_order
                sequence:
                  - app
                  - keyboard_control
              - type: tool_call_order
                sequence:
                  - app
                  - ui_type

          # OUTCOME: Proof that text was typed
          - anyOf:
              - type: output_regex
                pattern: "(?i)hello\\s*world"
              - type: tool_param_matches_regex
                tool: keyboard_control
                params:
                  text: "(?i)hello.*world"
              - type: tool_param_matches_regex
                tool: ui_type
                params:
                  text: "(?i)hello.*world"

          # OUTCOME: File was saved (agent mentions save/saved)
          - type: output_regex
            pattern: "(?i)(saved|file.*created|wrote.*file|save.*successful)"

          # OUTCOME: LLM verified Notepad was closed
          - type: output_regex
            pattern: "(?i)(no.*(notepad|window).*(open|found|running)|verified|notepad.*(closed|not found|no longer))"

          # QUALITY: Only used real tools
          - type: no_hallucinated_tools

          # QUALITY: No errors during execution
          - type: no_error_messages

          # QUALITY: Agent executed directly without asking for confirmation
          - type: no_clarification_questions

          # QUALITY: No rate limit errors encountered
          - type: no_rate_limit_errors
