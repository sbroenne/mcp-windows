# =============================================================================
# Real-World Workflows Test - Multi-Step Workflow Scenarios
# =============================================================================
#
# User Story 6: Real-World Workflow Scenarios (Priority: P2)
#
# Tests: Multi-step workflows matching 4sysops article patterns and spec
#        acceptance scenarios
#
# 8 Workflows:
#   1. Text Editing Workflow - type, select all, copy, paste (Notepad)
#   2. Menu Navigation Workflow - open Format menu, enable Word Wrap (Notepad)
#   3. Save Dialog Workflow - type text, save as file (Notepad)
#   4. State Discovery Workflow - discover toolbar tools (Paint)
#   5. Keyboard Shortcuts Workflow - Ctrl+A, Ctrl+C, End, Ctrl+V (Notepad)
#   6. Drawing Workflow - select brush, choose color, draw (Paint)
#   7. Window Lifecycle Workflow - launch, minimize, restore, close (Notepad)
#   8. Multi-App Workflow - open both apps, switch between, close both
#
# Test Applications: Notepad (notepad.exe), Paint (mspaint.exe)
#
# Prerequisites:
#   - Windows 10/11
#   - Windows MCP Server
#   - Environment: AZURE_OPENAI_ENDPOINT
#
# =============================================================================

criteria:
  success_rate: 1  # 100% required

providers:
  - name: azure-openai-gpt41
    type: AZURE
    auth_type: entra_id
    model: gpt-4.1
    baseUrl: "{{AZURE_OPENAI_ENDPOINT}}"
    version: 2025-01-01-preview
    retry:
      retry_on_429: true
      max_retries: 5
  - name: azure-openai-gpt5-chat
    type: AZURE
    auth_type: entra_id
    model: gpt-5.2-chat
    baseUrl: "{{AZURE_OPENAI_ENDPOINT}}"
    version: 2025-01-01-preview
    retry:
      retry_on_429: true
      max_retries: 5
servers:
  - name: windows-mcp
    type: stdio
    command: "{{SERVER_COMMAND}}"
    server_delay: 10s

agents:
  - name: gpt41-agent
    servers:
      - name: windows-mcp
    provider: azure-openai-gpt41
    system_prompt: |
      You are {{AGENT_NAME}}, an autonomous Windows automation agent using {{PROVIDER_NAME}}.
      Session: {{SESSION_NAME}}
      
      CRITICAL RULES:
      - Execute all tasks IMMEDIATELY without asking for confirmation
      - NEVER ask "Would you like me to...", "Should I proceed...", or similar questions
      - NEVER request clarification - make reasonable assumptions and proceed
      - Use available tools directly to complete the requested tasks
      - Report results after completion, not before starting
    clarification_detection:
      enabled: true
      level: warning
      use_builtin_patterns: true

  - name: gpt5-chat-agent
    servers:
      - name: windows-mcp
    provider: azure-openai-gpt5-chat
    system_prompt: |
      You are {{AGENT_NAME}}, an autonomous Windows automation agent using {{PROVIDER_NAME}}.
      Session: {{SESSION_NAME}}
      
      CRITICAL RULES:
      - Execute all tasks IMMEDIATELY without asking for confirmation
      - NEVER ask "Would you like me to...", "Should I proceed...", or similar questions
      - NEVER request clarification - make reasonable assumptions and proceed
      - Use available tools directly to complete the requested tasks
      - Report results after completion, not before starting
    clarification_detection:
      enabled: true
      level: warning
      use_builtin_patterns: true

settings:
  verbose: true
  max_iterations: 20  # Higher for multi-step workflows


sessions:
  # ==========================================================================
  # Session 1: Text Editing Workflow
  # Type paragraph, select all, copy, paste at end
  # ==========================================================================
  - name: "Text Editing Workflow"
    tests:
      - name: "Cleanup - Close existing Notepad windows"
        prompt: |
          Close all Notepad windows if any are open.
        assertions:
          - type: no_hallucinated_tools

      - name: "Complete text editing workflow"
        prompt: |
          Open Notepad, type "This is a test paragraph for the text editing workflow.", 
          then select all the text, copy it to clipboard, go to the end of the document, 
          add a new line, and paste the copied text. Finally, close Notepad without saving.
        assertions:
          - type: no_hallucinated_tools
          - type: tool_called
            tool: app
          - anyOf:
              - type: tool_called
                tool: keyboard_control
              - type: tool_called
                tool: ui_type
          - type: output_not_contains
            value: "failed"

  # ==========================================================================
  # Session 2: Menu Navigation Workflow
  # Open Format menu, enable Word Wrap
  # ==========================================================================
  - name: "Menu Navigation Workflow"
    tests:
      - name: "Cleanup - Close existing Notepad windows"
        prompt: |
          Close all Notepad windows if any are open.
        assertions:
          - type: no_hallucinated_tools

      - name: "Complete menu navigation workflow"
        prompt: |
          Open Notepad, navigate to the Format menu, and toggle the Word Wrap option.
          Then close Notepad without saving.
        assertions:
          - type: no_hallucinated_tools
          - type: tool_called
            tool: app
          - anyOf:
              - type: tool_called
                tool: ui_click
              - type: tool_called
                tool: ui_find
              - type: tool_called
                tool: keyboard_control
          - type: output_not_contains
            value: "failed"

  # ==========================================================================
  # Session 3: Save Dialog Workflow
  # Type text, save as test file with unique name
  # ==========================================================================
  - name: "Save Dialog Workflow"
    tests:
      - name: "Cleanup - Close existing Notepad windows"
        prompt: |
          Close all Notepad windows if any are open.
        assertions:
          - type: no_hallucinated_tools

      - name: "Complete save dialog workflow"
        prompt: |
          Open Notepad, type "Save workflow test content", and save the document 
          to the desktop with a filename that includes today's date and time.
          Then close Notepad.
        assertions:
          - type: no_hallucinated_tools
          - type: tool_called
            tool: app
          - anyOf:
              - type: tool_called
                tool: ui_file
              - type: tool_called
                tool: keyboard_control
              - type: tool_called
                tool: ui_click
          - type: output_not_contains
            value: "SecureDesktop"

  # ==========================================================================
  # Session 4: State Discovery Workflow
  # Discover all toolbar tools via screenshot or ui_find
  # ==========================================================================
  - name: "State Discovery Workflow"
    tests:
      - name: "Cleanup - Close existing Paint windows"
        prompt: |
          Close all Paint windows if any are open.
        assertions:
          - type: no_hallucinated_tools

      - name: "Complete state discovery workflow"
        prompt: |
          Open Microsoft Paint and discover all the available drawing tools 
          in the toolbar. List what tools you find, then close Paint without saving.
        assertions:
          - type: no_hallucinated_tools
          - type: tool_called
            tool: app
          - anyOf:
              - type: tool_called
                tool: screenshot_control
              - type: tool_called
                tool: ui_find
          - type: output_regex
            pattern: "(?i)(pencil|brush|eraser|shape|fill|tool)"

  # ==========================================================================
  # Session 5: Keyboard Shortcuts Workflow
  # Ctrl+A, Ctrl+C, End, Ctrl+V sequence
  # ==========================================================================
  - name: "Keyboard Shortcuts Workflow"
    tests:
      - name: "Cleanup - Close existing Notepad windows"
        prompt: |
          Close all Notepad windows if any are open.
        assertions:
          - type: no_hallucinated_tools

      - name: "Complete keyboard shortcuts workflow"
        prompt: |
          Open Notepad, type "Original text to duplicate", then use keyboard shortcuts 
          to select all text (Ctrl+A), copy it (Ctrl+C), move to the end (End key), 
          add a new line (Enter), and paste (Ctrl+V). Close Notepad without saving.
        assertions:
          - type: no_hallucinated_tools
          - type: tool_called
            tool: app
          - type: tool_called
            tool: keyboard_control
          - type: output_not_contains
            value: "failed"

  # ==========================================================================
  # Session 6: Drawing Workflow
  # Select brush, choose blue color, draw line across canvas
  # ==========================================================================
  - name: "Drawing Workflow"
    tests:
      - name: "Cleanup - Close existing Paint windows"
        prompt: |
          Close all Paint windows if any are open.
        assertions:
          - type: no_hallucinated_tools

      - name: "Complete drawing workflow"
        prompt: |
          Open Microsoft Paint, select the brush tool, choose the blue color 
          from the color palette, and draw a curved line across the canvas.
          Then close Paint without saving.
        assertions:
          - type: no_hallucinated_tools
          - type: tool_called
            tool: app
          - anyOf:
              - type: tool_called
                tool: ui_click
              - type: tool_called
                tool: ui_find
          - type: tool_called
            tool: mouse_control
          - type: output_not_contains
            value: "failed"

  # ==========================================================================
  # Session 7: Window Lifecycle Workflow
  # Launch, minimize, wait, restore, close
  # ==========================================================================
  - name: "Window Lifecycle Workflow"
    tests:
      - name: "Cleanup - Close existing Notepad windows"
        prompt: |
          Close all Notepad windows if any are open.
        assertions:
          - type: no_hallucinated_tools

      - name: "Complete window lifecycle workflow"
        prompt: |
          Open Notepad, minimize the window, wait 2 seconds, restore the window 
          to its normal state, then close Notepad without saving.
        assertions:
          - type: no_hallucinated_tools
          - type: tool_called
            tool: app
          - type: tool_called
            tool: window_management
          - type: output_not_contains
            value: "failed"

  # ==========================================================================
  # Session 8: Multi-App Workflow
  # Open Notepad and Paint, switch between, close both
  # ==========================================================================
  - name: "Multi-App Workflow"
    tests:
      - name: "Cleanup - Close existing Notepad and Paint windows"
        prompt: |
          Close all Notepad and Paint windows if any are open.
        assertions:
          - type: no_hallucinated_tools

      - name: "Complete multi-app workflow"
        prompt: |
          Open both Notepad and Microsoft Paint. Type "Hello" in Notepad.
          Switch to Paint and draw a small line on the canvas.
          Switch back to Notepad and type " World" after "Hello".
          Then close both applications without saving.
        assertions:
          - type: no_hallucinated_tools
          - type: tool_called
            tool: app
          - type: tool_called
            tool: window_management
          - anyOf:
              - type: tool_called
                tool: keyboard_control
              - type: tool_called
                tool: ui_type
          - type: tool_called
            tool: mouse_control
          - type: output_not_contains
            value: "failed"

