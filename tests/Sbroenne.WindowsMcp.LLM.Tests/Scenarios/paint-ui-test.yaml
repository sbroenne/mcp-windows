# =============================================================================
# Paint UI Test - Paint Canvas and Tool Operations
# =============================================================================
#
# User Story 5: Paint Canvas and Tool Operations (Priority: P2)
#
# Tests: Paint ribbon UI and canvas drawing operations
#
# Tools Covered:
#   - ui_find: Discover ribbon toolbar elements
#   - ui_click: Select tools and colors
#   - mouse_control(drag): Draw on canvas
#   - screenshot_control(annotate=true): Verify element discovery
#
# Test Application: Microsoft Paint (mspaint.exe)
#
# Prerequisites:
#   - Windows 10/11
#   - Windows MCP Server
#   - Environment: AZURE_OPENAI_ENDPOINT
#
# =============================================================================

criteria:
  success_rate: 1  # 100% required

providers:
  - name: azure-openai-gpt41
    type: AZURE
    auth_type: entra_id
    model: gpt-4.1
    baseUrl: "{{AZURE_OPENAI_ENDPOINT}}"
    version: 2025-01-01-preview
    rate_limits:
      tpm: 150000
      rpm: 1000
    retry:
      retry_on_429: true
      max_retries: 5

  - name: azure-openai-gpt5-chat
    type: AZURE
    auth_type: entra_id
    model: gpt-5.2-chat
    baseUrl: "{{AZURE_OPENAI_ENDPOINT}}"
    version: 2025-01-01-preview
    rate_limits:
      tpm: 150000
      rpm: 1500

servers:
  - name: windows-mcp
    type: stdio
    command: "{{SERVER_COMMAND}}"
    server_delay: 10s

agents:
  - name: gpt41-agent
    servers:
      - name: windows-mcp
    provider: azure-openai-gpt41
    system_prompt: |
      You are {{AGENT_NAME}}, an autonomous Windows automation agent using {{PROVIDER_NAME}}.
      Session: {{SESSION_NAME}}

      CRITICAL RULES:
      - Execute all tasks IMMEDIATELY without asking for confirmation
      - NEVER ask "Would you like me to...", "Should I proceed...", or similar questions
      - NEVER request clarification - make reasonable assumptions and proceed
      - Use available tools directly to complete the requested tasks
      - Report results after completion, not before starting
    clarification_detection:
      enabled: true
      level: warning
      use_builtin_patterns: true

  - name: gpt5-chat-agent
    servers:
      - name: windows-mcp
    provider: azure-openai-gpt5-chat
    system_prompt: |
      You are {{AGENT_NAME}}, an autonomous Windows automation agent using {{PROVIDER_NAME}}.
      Session: {{SESSION_NAME}}

      CRITICAL RULES:
      - Execute all tasks IMMEDIATELY without asking for confirmation
      - NEVER ask "Would you like me to...", "Should I proceed...", or similar questions
      - NEVER request clarification - make reasonable assumptions and proceed
      - Use available tools directly to complete the requested tasks
      - Report results after completion, not before starting
    clarification_detection:
      enabled: true
      level: warning
      use_builtin_patterns: true

settings:
  verbose: true
  max_iterations: 15


sessions:
  # ==========================================================================
  # Session 1: Tool Discovery - ui_find for ribbon toolbar elements
  # ==========================================================================
  - name: "Tool Discovery"
    tests:
      - name: "Cleanup - Close existing Paint windows"
        prompt: |
          Close all Paint windows if any are open.
        assertions:
          - type: no_hallucinated_tools

      - name: "Launch Paint"
        prompt: |
          Open Microsoft Paint.
        assertions:
          - type: no_hallucinated_tools
          - type: tool_called
            tool: app

      - name: "Find the pencil tool"
        prompt: |
          Find the pencil tool in the Paint toolbar.
        assertions:
          - type: no_hallucinated_tools
          - type: tool_called
            tool: ui_find
          - type: output_regex
            pattern: "(?i)(pencil|tool|found|element)"

      - name: "Find the brush tools"
        prompt: |
          Find the brush or brushes tool in the Paint toolbar.
        assertions:
          - type: no_hallucinated_tools
          - type: tool_called
            tool: ui_find
          - type: output_regex
            pattern: "(?i)(brush|tool|found|element)"

      - name: "Find the shapes tools"
        prompt: |
          Find the shapes or shape tools in the Paint toolbar.
        assertions:
          - type: no_hallucinated_tools
          - type: tool_called
            tool: ui_find
          - type: output_regex
            pattern: "(?i)(shape|tool|found|element)"

      - name: "Close Paint"
        prompt: |
          Close Paint without saving.
        assertions:
          - type: no_hallucinated_tools

  # ==========================================================================
  # Session 2: Tool Selection - ui_click for tool buttons
  # ==========================================================================
  - name: "Tool Selection"
    tests:
      - name: "Cleanup - Close existing Paint windows"
        prompt: |
          Close all Paint windows if any are open.
        assertions:
          - type: no_hallucinated_tools

      - name: "Launch Paint"
        prompt: |
          Open Microsoft Paint.
        assertions:
          - type: no_hallucinated_tools
          - type: tool_called
            tool: app

      - name: "Click on the pencil tool"
        prompt: |
          Click on the pencil tool to select it.
        assertions:
          - type: no_hallucinated_tools
          - anyOf:
              - type: tool_called
                tool: ui_click
              - type: tool_called
                tool: ui_find

      - name: "Click on the brush tool"
        prompt: |
          Click on the brush tool to select it.
        assertions:
          - type: no_hallucinated_tools
          - anyOf:
              - type: tool_called
                tool: ui_click
              - type: tool_called
                tool: ui_find

      - name: "Click on the eraser tool"
        prompt: |
          Click on the eraser tool to select it.
        assertions:
          - type: no_hallucinated_tools
          - anyOf:
              - type: tool_called
                tool: ui_click
              - type: tool_called
                tool: ui_find

      - name: "Close Paint"
        prompt: |
          Close Paint without saving.
        assertions:
          - type: no_hallucinated_tools

  # ==========================================================================
  # Session 3: Color Selection - ui_click for color palette
  # ==========================================================================
  - name: "Color Selection"
    tests:
      - name: "Cleanup - Close existing Paint windows"
        prompt: |
          Close all Paint windows if any are open.
        assertions:
          - type: no_hallucinated_tools

      - name: "Launch Paint"
        prompt: |
          Open Microsoft Paint.
        assertions:
          - type: no_hallucinated_tools
          - type: tool_called
            tool: app

      - name: "Select red color"
        prompt: |
          Click on the red color in the color palette to select it.
        assertions:
          - type: no_hallucinated_tools
          - anyOf:
              - type: tool_called
                tool: ui_click
              - type: tool_called
                tool: ui_find

      - name: "Select blue color"
        prompt: |
          Click on the blue color in the color palette to select it.
        assertions:
          - type: no_hallucinated_tools
          - anyOf:
              - type: tool_called
                tool: ui_click
              - type: tool_called
                tool: ui_find

      - name: "Select green color"
        prompt: |
          Click on the green color in the color palette to select it.
        assertions:
          - type: no_hallucinated_tools
          - anyOf:
              - type: tool_called
                tool: ui_click
              - type: tool_called
                tool: ui_find

      - name: "Close Paint"
        prompt: |
          Close Paint without saving.
        assertions:
          - type: no_hallucinated_tools

  # ==========================================================================
  # Session 4: Canvas Drawing - mouse_control(drag) for drawing
  # ==========================================================================
  - name: "Canvas Drawing"
    tests:
      - name: "Cleanup - Close existing Paint windows"
        prompt: |
          Close all Paint windows if any are open.
        assertions:
          - type: no_hallucinated_tools

      - name: "Launch Paint"
        prompt: |
          Open Microsoft Paint.
        assertions:
          - type: no_hallucinated_tools
          - type: tool_called
            tool: app

      - name: "Draw a diagonal line"
        prompt: |
          Draw a diagonal line from the top-left area of the canvas to the bottom-right area.
        assertions:
          - type: no_hallucinated_tools
          - type: tool_called
            tool: mouse_control
          - type: tool_param_equals
            tool: mouse_control
            params:
              action: "drag"

      - name: "Draw a horizontal line"
        prompt: |
          Draw a horizontal line across the middle of the canvas.
        assertions:
          - type: no_hallucinated_tools
          - type: tool_called
            tool: mouse_control
          - type: tool_param_equals
            tool: mouse_control
            params:
              action: "drag"

      - name: "Close Paint"
        prompt: |
          Close Paint without saving.
        assertions:
          - type: no_hallucinated_tools

  # ==========================================================================
  # Session 5: State Discovery - screenshot_control(annotate=true)
  # ==========================================================================
  - name: "State Discovery"
    tests:
      - name: "Cleanup - Close existing Paint windows"
        prompt: |
          Close all Paint windows if any are open.
        assertions:
          - type: no_hallucinated_tools

      - name: "Launch Paint"
        prompt: |
          Open Microsoft Paint.
        assertions:
          - type: no_hallucinated_tools
          - type: tool_called
            tool: app

      - name: "Take an annotated screenshot to discover UI elements"
        prompt: |
          Take a screenshot of Paint with element labels to discover all available UI elements and tools.
        assertions:
          - type: no_hallucinated_tools
          - type: tool_called
            tool: screenshot_control
          - type: tool_param_equals
            tool: screenshot_control
            params:
              annotate: true
          - type: output_regex
            pattern: "(?i)(element|label|annotation|tool|canvas|color)"

      - name: "Close Paint"
        prompt: |
          Close Paint without saving.
        assertions:
          - type: no_hallucinated_tools

