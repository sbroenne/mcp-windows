{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://github.com/sbroenne/mcp-windows/specs/007-llm-integration-testing/contracts/scenario-schema.json",
  "title": "LLM Integration Test Scenario Schema",
  "description": "JSON Schema for validating test scenario markdown frontmatter (optional)",
  "type": "object",
  "required": ["id", "category", "priority", "objective", "preconditions", "steps", "expectedResult", "passCriteria"],
  "properties": {
    "id": {
      "type": "string",
      "pattern": "^TC-(MOUSE|KEYBOARD|WINDOW|SCREENSHOT|WORKFLOW|ERROR|VISUAL)-[0-9]{3}$",
      "description": "Unique test case identifier"
    },
    "category": {
      "type": "string",
      "enum": ["MOUSE", "KEYBOARD", "WINDOW", "SCREENSHOT", "WORKFLOW", "ERROR", "VISUAL"],
      "description": "Test category for grouping and filtering"
    },
    "priority": {
      "type": "string",
      "enum": ["P1", "P2", "P3"],
      "description": "Test priority (P1=Critical, P2=Important, P3=Nice-to-have)"
    },
    "objective": {
      "type": "string",
      "minLength": 10,
      "description": "What this test verifies"
    },
    "preconditions": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "minItems": 1,
      "description": "Required state before test execution"
    },
    "steps": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/testStep"
      },
      "minItems": 1,
      "description": "Ordered list of actions to perform"
    },
    "expectedResult": {
      "type": "string",
      "minLength": 10,
      "description": "What should happen if test passes"
    },
    "passCriteria": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "minItems": 1,
      "description": "Checkable items for pass/fail determination"
    },
    "tools": {
      "type": "array",
      "items": {
        "type": "string",
        "enum": [
          "mcp_windows_mcp_s_mouse_control",
          "mcp_windows_mcp_s_keyboard_control",
          "mcp_windows_mcp_s_window_management",
          "mcp_windows_mcp_s_screenshot_control"
        ]
      },
      "description": "MCP tools exercised by this test"
    },
    "targetApp": {
      "type": "string",
      "enum": ["Notepad", "Calculator", "None"],
      "default": "None",
      "description": "Target application for the test"
    },
    "dependencies": {
      "type": "array",
      "items": {
        "type": "string",
        "pattern": "^TC-(MOUSE|KEYBOARD|WINDOW|SCREENSHOT|WORKFLOW|ERROR|VISUAL)-[0-9]{3}$"
      },
      "description": "Other test cases that must pass before this one"
    },
    "targetMonitor": {
      "type": "string",
      "enum": ["primary", "secondary", "any"],
      "default": "secondary",
      "description": "Which monitor to use for test execution"
    },
    "timeout": {
      "type": "integer",
      "minimum": 1,
      "maximum": 300,
      "default": 30,
      "description": "Maximum execution time in seconds"
    },
    "failureIndicators": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "Common failure patterns to watch for"
    },
    "notes": {
      "type": "string",
      "description": "Additional context or known issues"
    }
  },
  "$defs": {
    "testStep": {
      "type": "object",
      "required": ["stepNumber", "action"],
      "properties": {
        "stepNumber": {
          "type": "integer",
          "minimum": 1,
          "description": "Order of execution (1-based)"
        },
        "action": {
          "type": "string",
          "description": "What to do (natural language or MCP tool call)"
        },
        "tool": {
          "type": "string",
          "description": "MCP tool to invoke (if applicable)"
        },
        "parameters": {
          "type": "object",
          "description": "Parameters for MCP tool (if applicable)"
        },
        "verification": {
          "type": "string",
          "description": "How to verify this step succeeded"
        }
      }
    }
  },
  "additionalProperties": false
}
